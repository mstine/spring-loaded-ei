<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/integration"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd">
		
			<context:component-scan base-package="com.dss.slei"/>
			
			<gateway id="ticketService"
				service-interface="com.dss.slei.service.TicketService" 
				default-request-channel="jsonTicketRequestChannel"
				default-reply-channel="acceptedTicketsChannel"
				default-reply-timeout="5000"/>
				
			<gateway id="ticketBatchService"
				service-interface="com.dss.slei.service.TicketBatchService" 
				default-request-channel="ticketBatchChannel"
				default-reply-channel="ticketBatchWithIdsChannel"
				default-reply-timeout="5000"/>
					
			<publish-subscribe-channel id="jsonTicketRequestChannel"/>
			
			<channel id="ticketBatchChannel"/>
						
			<logging-channel-adapter id="jsonTicketRequestChannelLogger"
				channel="jsonTicketRequestChannel"/>
			
			<json-to-object-transformer id="jsonToObjectTransformer" 
				input-channel="jsonTicketRequestChannel"
				output-channel="newTicketObjectChannel"
				type="com.dss.slei.service.Ticket "/>
				
			<channel id="newTicketObjectChannel"/>
							
			<filter id="miltonTicketFilter"
				input-channel="newTicketObjectChannel"
				output-channel="assignIdChannel"
				discard-channel="rejectedTicketsChannel"
				ref="ticketFilter"
				method="isNotFromMilton"/>
				
			<channel id="assignIdChannel"/>
			
			<service-activator id="assignIdService"
				input-channel="assignIdChannel"
				output-channel="acceptedTicketsChannel"
				ref="ticketIdService"
				method="assignIdTo"/>	
					
			<publish-subscribe-channel id="acceptedTicketsChannel"/>
			
			<publish-subscribe-channel id="rejectedTicketsChannel"/>
			
			<logging-channel-adapter id="acceptedTicketsLogger"
				channel="acceptedTicketsChannel"
				logger-name="ACCEPTED TICKET"/>
				
			<logging-channel-adapter id="rejectedTicketsLogger"
				channel="rejectedTicketsChannel"
				logger-name="REJECTED TICKET"/>
							
			<router id="staffMemberTicketRouter"
				input-channel="acceptedTicketsChannel"
				ref="ticketRouter"
				method="staffMemberFor"
				default-output-channel="rejectedTicketsChannel"/>
				
			<channel id="NINA"/>
			<channel id="B_LUMBERGH"/>
			<channel id="M_BOLTON"/>
			<channel id="P_GIBBONS"/>
			
			<logging-channel-adapter id="ninaTicketsLogger"
				channel="NINA"
				logger-name="ROUTED TO NINA"/>
				
			<logging-channel-adapter id="blumberghTicketsLogger"
				channel="B_LUMBERGH"
				logger-name="ROUTED TO BILL LUMBERGH"/>
				
			<logging-channel-adapter id="mboltonTicketsLogger"
				channel="M_BOLTON"
				logger-name="ROUTED TO MICHAEL BOLTON"/>
				
			<logging-channel-adapter id="pgibbonsTicketsLogger"
				channel="P_GIBBONS"
				logger-name="ROUTED TO PETER GIBBONS"/>
				
			<splitter id="ticketBatchSplitterBean"
				input-channel="ticketBatchChannel"
				output-channel="newTicketObjectChannel"
				ref="ticketBatchSplitter"
				method="ticketsFrom" />	
									
			<recipient-list-router id="acceptedTicketRecipientListRouter" 
				input-channel="acceptedTicketsChannel"
				resolution-required="false"
				default-output-channel="nullChannel">
				<recipient channel="ticketsToAggregateChannel" selector-expression="headers.containsKey('correlationId') "/>
			</recipient-list-router>
			
			<recipient-list-router id="rejectedTicketRecipientListRouter"
				input-channel="rejectedTicketsChannel"
				resolution-required="false"
				default-output-channel="nullChannel">
				<recipient channel="ticketsToAggregateChannel" selector-expression="headers.containsKey('correlationId')"/>
			</recipient-list-router>	
			
			<channel id="ticketsToAggregateChannel"/>
				
			<aggregator id="ticketBatchAggregator"
				input-channel="ticketsToAggregateChannel"
				output-channel="ticketBatchWithIdsChannel"
				ref="ticketBatchBuilder"
				method="createFrom"
				send-timeout="5000"/>
				
			<publish-subscribe-channel id="ticketBatchWithIdsChannel"/>
						
			<logging-channel-adapter id="ticketBatchWithIdsLogger"
				channel="ticketBatchWithIdsChannel"
				logger-name="TICKET BATCH"/>
							
</beans:beans>
